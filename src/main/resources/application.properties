spring.application.name=billing-service

# ===================== DATASOURCE =====================

spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/constructoresvanguardistas}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:}
spring.datasource.driver-class-name=org.postgresql.Driver

# ===================== JPA / HIBERNATE =====================

spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# ===================== FLYWAY =====================

spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=1
spring.flyway.url=${spring.datasource.url}
spring.flyway.user=${spring.datasource.username}
spring.flyway.password=${spring.datasource.password}
spring.flyway.locations=classpath:db.migration

# ===================== SQL INIT =====================

spring.sql.init.mode=never

# ===================== LOGGING (DEV ONLY) =====================

logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.orm.jdbc.bind=TRACE

# ===================== JWT / CORS / TRACING =====================

# ==== JWT ====

app.security.jwt.alg=${JWT_ALG:RS256}
app.security.jwt.issuer=${JWT_ISS:https://cvanguardistas.auth}
app.security.jwt.audience=${JWT_AUD:api-billing}
app.security.jwt.access-ttl-minutes=${JWT_ACCESS_TTL_MINUTES:30}
app.security.jwt.refresh-ttl-days=${JWT_REFRESH_TTL_DAYS:14}

# PEM embebido (vac√≠o por defecto)
app.security.jwt.private-key-pem=${JWT_PRIVATE_KEY_PEM:}
app.security.jwt.public-key-pem=${JWT_PUBLIC_KEY_PEM:}

# Rutas a archivos PEM
app.security.jwt.private-key-path=${JWT_PRIVATE_KEY_PATH:${user.dir}/secrets/jwt-private.pem}
app.security.jwt.public-key-path=${JWT_PUBLIC_KEY_PATH:${user.dir}/secrets/jwt-public.pem}

# ==== CORS ====

app.security.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:4200,http://localhost:5173}
app.security.cors.allowed-methods=GET,POST,PATCH,PUT,DELETE,OPTIONS
app.security.cors.allowed-headers=Authorization,Content-Type,X-Correlation-Id
app.security.cors.allow-credentials=true

# ==== Tracing ====

app.security.tracing.correlation-header=${CORRELATION_HEADER:X-Correlation-Id}

# ==== Actuator ====

management.endpoints.web.exposure.include=health,info
